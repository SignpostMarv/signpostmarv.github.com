<html>
<head>
<title>diceRoll.js example</title>
<script src="./domready.js"></script>
<script src="../../build/diceRoll.min.js"></script>
</head>
<body>
<script>
domready(function(){
	var
		form = document.forms[0],
		spec = form.querySelector('input'),
		button = form.querySelector('button'),
		output = form.querySelector('#output'),
		roller = form.querySelector('#roller'),
		roll = undefined,
		regex = diceRoll.regex.toString(),
		regex = '^' + regex.substring(1, regex.length - 1) + '$',
		resultIndex = [],
		resultsCheck = [],
		results = [],
		start = 0,
		fin = 0,
		proc = 0,
		rend = 0,
		genOutput = function(){
			while(output.hasChildNodes()){
				output.removeChild(output.firstChild);
			}
			try{
				if(roll == undefined || spec.value != roll._spec){
					roll = new diceRoll(spec.value);
				}
				resultIndex = [];
				resultsCheck = [];
				start = (new Date()).getTime();
				results = roll.multiRoll(parseInt(roller.value,10));
				fin = (new Date()).getTime();
				for(var i=0;i<results.length;++i){
					var
						pos = resultIndex.indexOf(results[i])
					;
					if(pos == -1){
						pos = resultIndex.length;
						resultIndex.push(results[i]);
						resultsCheck[pos] = 0;
					}
					++resultsCheck[pos];
				}
				results = resultIndex;
				results.sort(function(a,b){ return a-b;});
				proc = (new Date()).getTime();
				for(var i=0;i<results.length;++i){
					var
						tr = document.createElement('tr'),
						th = document.createElement('th'),
						td = document.createElement('td')
					;
					th.scope = 'row';
					th.appendChild(document.createTextNode(results[i]));
					td.appendChild(document.createTextNode(resultsCheck[resultIndex.indexOf(results[i])]));
					tr.appendChild(th);
					tr.appendChild(td);
					output.appendChild(tr, output.firstChild);
				}
				rend = (new Date()).getTime();
				var
					rollTimeTr = document.createElement('tr'),
					rollTimeTh = document.createElement('th'),
					rollTimeTd = document.createElement('td'),
					procTimeTr = document.createElement('tr'),
					procTimeTh = document.createElement('th'),
					procTimeTd = document.createElement('td'),
					renderTr = document.createElement('tr'),
					renderTh = document.createElement('th'),
					renderTd = document.createElement('td')
				;
				rollTimeTh.appendChild(document.createTextNode('Time to roll:'));
				rollTimeTd.appendChild(document.createTextNode((fin - start) + 'ms'));
				procTimeTh.appendChild(document.createTextNode('Time to process:'));
				procTimeTd.appendChild(document.createTextNode((proc - fin) + 'ms'));
				rollTimeTr.appendChild(rollTimeTh);
				rollTimeTr.appendChild(rollTimeTd);
				procTimeTr.appendChild(procTimeTh);
				procTimeTr.appendChild(procTimeTd);
				renderTh.appendChild(document.createTextNode('Time to render'));
				renderTd.appendChild(document.createTextNode((rend - proc) + 'ms'));
				renderTr.appendChild(renderTh);
				renderTr.appendChild(renderTd);
				output.insertBefore(rollTimeTr, output.firstChild);
				output.insertBefore(procTimeTr, rollTimeTr.nextSibling);
				output.insertBefore(renderTr, procTimeTr.nextSibling);
			}catch(e){
				alert(e);
			}
			return false;
		}
	;
	button.disabled = spec.disabled = false;
	spec.pattern = regex;
	form.onsubmit = genOutput;
	genOutput();
})
</script>
<form>
	<ul>
		<li><label for=spec>Specification: </label><input disabled required id=spec value="2d+10"></li>
		<li><label for=roller>Roller: </label><input type=number min=1 id=roller value=1000000></li>
		<li><button type=submit disabled>Roll</button></li>
	</ul>
	<table>
		<thead>
			<tr>
				<th>Result</th>
				<th>Value</th>
			</tr>
		</thead>
		<tbody id=output>
		</tbody>
	</table>
</form>
</body>
</html>